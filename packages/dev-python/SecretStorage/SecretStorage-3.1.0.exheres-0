# Copyright 2018 Alexander Kapshuna <kapsh@kap.sh>
# Distributed under the terms of the GNU General Public License v2

require pypi setup-py [ import=setuptools blacklist="2 3.4" ]

SUMMARY="Python bindings to FreeDesktop.org Secret Service API"

LICENCES="BSD-3"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS=""

DEPENDENCIES="
    build+run:
        dev-python/cryptography[python_abis:*(-)?]
        dev-python/jeepney[python_abis:*(-)?]
    test:
        sys-apps/dbus
        gnome-desktop/gnome-keyring
"

test_one_multibuild() {
    local whitelist=(
        "unix-abstract:/tmp/dbus-*"
        "--connect unix:/dev/log"
        "unix:${TEMP}/keyring/control"
        "--connect unix:/var/run/dbus/system_bus_socket"
    )
    for item in "${whitelist[@]}"; do
        esandbox allow_net ${item}
    done
    edo dbus-run-session -- ${PYTHON} -m unittest discover -s tests
    for item in "${whitelist[@]}"; do
        esandbox disallow_net ${item}
    done
}

